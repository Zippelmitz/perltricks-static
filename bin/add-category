#!/usr/bin/env perl
use autodie;
use strict;
use warnings;
use JSON qw/decode_json/;

my $filename = shift or die "provide filename\n";
my $category = shift or die "provide category\n";

open my $fh, '<', $filename;
my $text = do { local($/);<$fh> };

$text = add_category($text, $category);

print $text;

sub add_category {
  my ($text, $category) = @_;
  my ($header, $body) = $text =~ /({.+?})(.+?)$/s;

  die "unable to parse header & body from article\n"
    unless $header && $body;

  my $json = decode_json($header);
  $json->{category} = $category;
  $header = JSON->new->pretty->encode($json);
  return $header . $body;
}
